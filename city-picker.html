<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>省市区选择</title>
  <style>
    select { margin: 5px; padding: 5px; }
  </style>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://js.jotform.com/JotFormCustomWidget.min.js"></script>
</head>
<body>
  <label>省：
    <select id="province"></select>
  </label>
  <label>市：
    <select id="city"></select>
  </label>
  <label>区：
    <select id="area"></select>
  </label>

  <script>
    const dataUrl = "https://githunter-007.github.io/cn_city-picker/list.json"; // 你的 JSON 链接

    let regionData = {};
    let provinces = [];

    function loadOptions($select, items) {
      $select.empty();
      items.forEach(item => {
        $select.append(`<option value="${item.code}">${item.name}</option>`);
      });
    }

    function getChildren(parentCode, level) {
      return Object.entries(regionData)
        .filter(([code]) => {
          if (level === 'province') return code.endsWith('0000');
          if (level === 'city') return code.startsWith(parentCode.slice(0, 2)) && code.endsWith('00') && !code.endsWith('0000');
          if (level === 'area') return code.startsWith(parentCode.slice(0, 4)) && !code.endsWith('00');
        })
        .map(([code, name]) => ({ code, name }));
    }

    $(async function () {
      const res = await fetch(dataUrl);
      regionData = await res.json();

      provinces = getChildren('', 'province');
      loadOptions($('#province'), provinces);

      $('#province').on('change', function () {
        const cities = getChildren(this.value, 'city');
        loadOptions($('#city'), cities);
        $('#city').trigger('change');
      });

      $('#city').on('change', function () {
        const areas = getChildren(this.value, 'area');
        loadOptions($('#area'), areas);
      });

      $('#province').trigger('change');

      // JotForm Widget API
      JFCustomWidget.subscribe("submit", function () {
        const provinceName = $('#province option:selected').text();
        const cityName = $('#city option:selected').text();
        const areaName = $('#area option:selected').text();

        JFCustomWidget.sendSubmit({
          valid: true,
          value: {
            province: provinceName,
            city: cityName,
            area: areaName
          }
        });
      });
    });
  </script>
</body>
</html>
